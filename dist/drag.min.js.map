{"version":3,"file":"drag.min.js","sources":["../lib/drag.js"],"sourcesContent":["let activeDraggedElement;\r\nlet startX, startY;\r\nlet lastX, lastY;\r\nlet checkDragPos;\r\n\r\nconst defaults = {\r\n    threshold: 0,\r\n};\r\n\r\nconst options = new WeakMap();\r\n\r\nexport function enableDragEvents(elm, opt = defaults) {\r\n    elm.addEventListener(\"touchstart\", onPointerDown, true);\r\n    elm.addEventListener(\"mousedown\", onPointerDown, true);\r\n    options.set(elm, opt);\r\n}\r\n\r\n// create dummy mouse event object to get mouse related properties like e.clientX e.clientY, e.altKey, etc..\r\nconst MOUSE_EVENT_PROPS = Object.keys(\r\n    Object.getPrototypeOf(new MouseEvent(\"\"))\r\n);\r\n\r\nconst TOUCH_EVENT_PROPS = [\"changedTouches\", \"touches\", \"targetTouches\"];\r\n\r\nfunction getPointerPosition(e) {\r\n    if (e.changedTouches) e = e.changedTouches[0];\r\n    return [e.clientX, e.clientY];\r\n}\r\n\r\nfunction onPointerDown(e) {\r\n    activeDraggedElement = e.currentTarget;\r\n    checkDragPos = true;\r\n\r\n    [startX, startY] = getPointerPosition(e);\r\n\r\n    addOrRemoveEvents();\r\n}\r\n\r\nfunction onPointerMove(e) {\r\n    if (!activeDraggedElement) return;\r\n\r\n    const [x, y] = getPointerPosition(e);\r\n\r\n    if (checkDragPos) {\r\n        const opt = options.get(activeDraggedElement);\r\n\r\n        if (Math.hypot(x - startX, y - startY) < opt.threshold) return;\r\n\r\n        checkDragPos = false;\r\n        [lastX, lastY] = [x, y];\r\n\r\n        if (!dispatchDragEvent(\"ezgdragstart\", e)) {\r\n            removeDragEvents();\r\n        }\r\n    } else if (dispatchDragEvent(\"ezgdragmove\", e)) {\r\n        [lastX, lastY] = [x, y];\r\n    }\r\n}\r\n\r\nfunction getDragPositions(e) {\r\n    const [clientX, clientY] = getPointerPosition(e);\r\n    return {\r\n        startX,\r\n        startY,\r\n        lastX,\r\n        lastY,\r\n\r\n        //current mouse position\r\n        clientX,\r\n        clientY,\r\n\r\n        // mouse delta from initial drag position\r\n        offsetX: clientX - startX,\r\n        offsetY: clientY - startY,\r\n\r\n        // mouse delta from last drag position\r\n        movementX: clientX - lastX,\r\n        movementY: clientY - lastY,\r\n    };\r\n}\r\n\r\nfunction removeDragEvents() {\r\n    activeDraggedElement = undefined;\r\n\r\n    addOrRemoveEvents(true);\r\n}\r\n\r\nfunction onPointerUp(e) {\r\n    if (activeDraggedElement && !checkDragPos) {\r\n        dispatchDragEvent(\"ezgdragstop\", e, false);\r\n    }\r\n\r\n    removeDragEvents();\r\n}\r\n\r\nfunction addOrRemoveEvents(remove) {\r\n    const fn = remove ? \"removeEventListener\" : \"addEventListener\";\r\n    document[fn](\"mouseup\", onPointerUp);\r\n    document[fn](\"touchend\", onPointerUp);\r\n    document[fn](\"mousemove\", onPointerMove);\r\n    document[fn](\"touchmove\", onPointerMove);\r\n}\r\n\r\nfunction dispatchDragEvent(name, e, cancelable = true) {\r\n    return dispatchCustomEvent(name, activeDraggedElement, {\r\n        detail: {\r\n            ...getDragPositions(e),\r\n            originalEvent: e,\r\n        },\r\n        cancelable,\r\n    });\r\n}\r\n\r\nfunction dispatchCustomEvent(name, elm, data) {\r\n    return elm.dispatchEvent(new CustomEvent(name, data));\r\n}\r\n"],"names":["activeDraggedElement","startX","startY","lastX","lastY","checkDragPos","defaults","threshold","options","WeakMap","Object","keys","getPrototypeOf","MouseEvent","getPointerPosition","e","changedTouches","clientX","clientY","onPointerDown","currentTarget","addOrRemoveEvents","onPointerMove","x","y","opt","get","Math","hypot","dispatchDragEvent","removeDragEvents","getDragPositions","offsetX","offsetY","movementX","movementY","undefined","onPointerUp","remove","fn","document","name","cancelable","elm","data","dispatchEvent","CustomEvent","dispatchCustomEvent","detail","originalEvent","addEventListener","set"],"mappings":"wMAAA,IAAIA,EACAC,EAAQC,EACRC,EAAOC,EACPC,EAEJ,MAAMC,EAAW,CACbC,UAAW,GAGTC,EAAU,IAAIC,QASMC,OAAOC,KAC7BD,OAAOE,eAAe,IAAIC,WAAW,MAKzC,SAASC,EAAmBC,GAExB,OADIA,EAAEC,iBAAgBD,EAAIA,EAAEC,eAAe,IACpC,CAACD,EAAEE,QAASF,EAAEG,SAGzB,SAASC,EAAcJ,GACnBf,EAAuBe,EAAEK,cACzBf,GAAe,GAEdJ,EAAQC,GAAUY,EAAmBC,GAEtCM,IAGJ,SAASC,EAAcP,GACnB,IAAKf,EAAsB,OAE3B,MAAOuB,EAAGC,GAAKV,EAAmBC,GAElC,GAAIV,EAAc,CACd,MAAMoB,EAAMjB,EAAQkB,IAAI1B,GAExB,GAAI2B,KAAKC,MAAML,EAAItB,EAAQuB,EAAItB,GAAUuB,EAAIlB,UAAW,OAExDF,GAAe,GACdF,EAAOC,GAAS,CAACmB,EAAGC,GAEhBK,EAAkB,eAAgBd,IACnCe,SAEGD,EAAkB,cAAed,MACvCZ,EAAOC,GAAS,CAACmB,EAAGC,IAI7B,SAASO,EAAiBhB,GACtB,MAAOE,EAASC,GAAWJ,EAAmBC,GAC9C,MAAO,CACHd,OAAAA,EACAC,OAAAA,EACAC,MAAAA,EACAC,MAAAA,EAGAa,QAAAA,EACAC,QAAAA,EAGAc,QAASf,EAAUhB,EACnBgC,QAASf,EAAUhB,EAGnBgC,UAAWjB,EAAUd,EACrBgC,UAAWjB,EAAUd,GAI7B,SAAS0B,IACL9B,OAAuBoC,EAEvBf,GAAkB,GAGtB,SAASgB,EAAYtB,GACbf,IAAyBK,GACzBwB,EAAkB,cAAed,GAAG,GAGxCe,IAGJ,SAAST,EAAkBiB,GACvB,MAAMC,EAAKD,EAAS,sBAAwB,mBAC5CE,SAASD,GAAI,UAAWF,GACxBG,SAASD,GAAI,WAAYF,GACzBG,SAASD,GAAI,YAAajB,GAC1BkB,SAASD,GAAI,YAAajB,GAG9B,SAASO,EAAkBY,EAAM1B,EAAG2B,GAAa,GAC7C,OASJ,SAA6BD,EAAME,EAAKC,GACpC,OAAOD,EAAIE,cAAc,IAAIC,YAAYL,EAAMG,IAVxCG,CAAoBN,EAAMzC,EAAsB,CACnDgD,OAAQ,IACDjB,EAAiBhB,GACpBkC,cAAelC,GAEnB2B,WAAAA,uBAlGD,SAA0BC,EAAKlB,EAAMnB,GACxCqC,EAAIO,iBAAiB,aAAc/B,GAAe,GAClDwB,EAAIO,iBAAiB,YAAa/B,GAAe,GACjDX,EAAQ2C,IAAIR,EAAKlB"}