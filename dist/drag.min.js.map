{"version":3,"file":"drag.min.js","sources":["../lib/shared.js","../lib/drag.js"],"sourcesContent":["export function dispatchCustomEvent(name, elm, detail, cancelable = true) {\r\n    return !elm.dispatchEvent(\r\n        new CustomEvent(`ezg${name}`, { detail, cancelable })\r\n    );\r\n}\r\n","import { dispatchCustomEvent } from \"./shared\";\n\nlet activeDraggedElement;\nlet startX, startY;\nlet lastX, lastY;\nlet checkDragPos;\n\nconst defaults = {\n    threshold: 0,\n};\n\nconst options = new WeakMap();\n\nexport function enableDragEvents(elm, opt = defaults) {\n    console.log(\"addedsdfglkjsdfjlks\");\n    elm.addEventListener(\"touchstart\", onPointerDown, true);\n    elm.addEventListener(\"mousedown\", onPointerDown, true);\n    options.set(elm, opt);\n}\n\n// create dummy mouse event object to get mouse related properties like e.clientX e.clientY, e.altKey, etc..\nconst MOUSE_EVENT_PROPS = Object.keys(\n    Object.getPrototypeOf(new MouseEvent(\"\"))\n);\n\nconst TOUCH_EVENT_PROPS = [\"changedTouches\", \"touches\", \"targetTouches\"];\n\nfunction getPointerPosition(e) {\n    if (e.changedTouches) e = e.changedTouches[0];\n    return [e.clientX, e.clientY];\n}\n\nfunction onPointerDown(e) {\n    e.preventDefault();\n    activeDraggedElement = e.currentTarget;\n    checkDragPos = true;\n\n    [startX, startY] = getPointerPosition(e);\n\n    addOrRemoveEvents();\n}\n\nfunction onPointerMove(e) {\n    e.preventDefault();\n    if (!activeDraggedElement) return;\n\n    const [x, y] = getPointerPosition(e);\n\n    if (checkDragPos) {\n        const opt = options.get(activeDraggedElement);\n\n        if (Math.hypot(x - startX, y - startY) < opt.threshold) return;\n\n        checkDragPos = false;\n        [lastX, lastY] = [x, y];\n\n        console.log(\"hello\");\n        if (!dispatchDragEvent(\"dragstart\", e)) {\n            removeDragEvents();\n        }\n    } else if (dispatchDragEvent(\"dragmove\", e)) {\n        [lastX, lastY] = [x, y];\n    }\n}\n\nfunction getDragPositions(e) {\n    const [clientX, clientY] = getPointerPosition(e);\n    return {\n        startX,\n        startY,\n        lastX,\n        lastY,\n\n        //current mouse position\n        clientX,\n        clientY,\n\n        // mouse delta from initial drag position\n        offsetX: clientX - startX,\n        offsetY: clientY - startY,\n\n        // mouse delta from last drag position\n        movementX: clientX - lastX,\n        movementY: clientY - lastY,\n    };\n}\n\nfunction removeDragEvents() {\n    activeDraggedElement = undefined;\n\n    addOrRemoveEvents(true);\n}\n\nfunction onPointerUp(e) {\n    if (activeDraggedElement && !checkDragPos) {\n        dispatchDragEvent(\"dragstop\", e, false);\n    }\n\n    removeDragEvents();\n}\n\nfunction addOrRemoveEvents(remove) {\n    const fn = remove ? \"removeEventListener\" : \"addEventListener\";\n    document[fn](\"mouseup\", onPointerUp);\n    document[fn](\"touchend\", onPointerUp);\n    document[fn](\"mousemove\", onPointerMove);\n    document[fn](\"touchmove\", onPointerMove);\n}\n\nfunction dispatchDragEvent(name, e, cancelable = true) {\n    return dispatchCustomEvent(\n        name,\n        activeDraggedElement,\n        {\n            ...getDragPositions(e),\n            originalEvent: e,\n        },\n        cancelable\n    );\n}\n"],"names":[],"mappings":"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"}