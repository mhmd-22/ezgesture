{"version":3,"file":"drag.min.js","sources":["../lib/drag.js","../lib/shared.js"],"sourcesContent":["import { dispatchCustomEvent } from \"./shared\";\n\nlet activeDraggedElement;\nlet startX, startY;\nlet lastX, lastY;\nlet checkDragPos;\n\nconst defaults = {\n    threshold: 0,\n};\n\nconst options = new WeakMap();\n\nexport function enableDragEvents(elm, opt = defaults) {\n    elm.addEventListener(\"touchstart\", onPointerDown, true);\n    elm.addEventListener(\"mousedown\", onPointerDown, true);\n    options.set(elm, opt);\n}\n\n// create dummy mouse event object to get mouse related properties like e.clientX e.clientY, e.altKey, etc..\nconst MOUSE_EVENT_PROPS = Object.keys(\n    Object.getPrototypeOf(new MouseEvent(\"\"))\n);\n\nconst TOUCH_EVENT_PROPS = [\"changedTouches\", \"touches\", \"targetTouches\"];\n\nfunction getPointerPosition(e) {\n    if (e.changedTouches) e = e.changedTouches[0];\n    return [e.clientX, e.clientY];\n}\n\nfunction onPointerDown(e) {\n    e.preventDefault();\n    activeDraggedElement = e.currentTarget;\n    checkDragPos = true;\n\n    [startX, startY] = getPointerPosition(e);\n\n    addOrRemoveEvents();\n}\n\nfunction onPointerMove(e) {\n    e.preventDefault();\n    if (!activeDraggedElement) return;\n\n    const [x, y] = getPointerPosition(e);\n\n    if (checkDragPos) {\n        const opt = options.get(activeDraggedElement);\n\n        if (Math.hypot(x - startX, y - startY) < opt.threshold) return;\n\n        checkDragPos = false;\n        [lastX, lastY] = [x, y];\n\n        if (!dispatchDragEvent(\"dragstart\", e)) {\n            removeDragEvents();\n        }\n    } else if (dispatchDragEvent(\"dragmove\", e)) {\n        [lastX, lastY] = [x, y];\n    }\n}\n\nfunction getDragPositions(e) {\n    const [clientX, clientY] = getPointerPosition(e);\n    return {\n        startX,\n        startY,\n        lastX,\n        lastY,\n\n        //current mouse position\n        clientX,\n        clientY,\n\n        // mouse delta from initial drag position\n        offsetX: clientX - startX,\n        offsetY: clientY - startY,\n\n        // mouse delta from last drag position\n        movementX: clientX - lastX,\n        movementY: clientY - lastY,\n    };\n}\n\nfunction removeDragEvents() {\n    activeDraggedElement = undefined;\n\n    addOrRemoveEvents(true);\n}\n\nfunction onPointerUp(e) {\n    if (activeDraggedElement && !checkDragPos) {\n        dispatchDragEvent(\"dragstop\", e, false);\n    }\n\n    removeDragEvents();\n}\n\nfunction addOrRemoveEvents(remove) {\n    const fn = remove ? \"removeEventListener\" : \"addEventListener\";\n    document[fn](\"mouseup\", onPointerUp);\n    document[fn](\"touchend\", onPointerUp);\n    document[fn](\"mousemove\", onPointerMove);\n    document[fn](\"touchmove\", onPointerMove);\n}\n\nfunction dispatchDragEvent(name, e, cancelable = true) {\n    return dispatchCustomEvent(\n        name,\n        activeDraggedElement,\n        {\n            ...getDragPositions(e),\n            originalEvent: e,\n        },\n        cancelable\n    );\n}\n","export function dispatchCustomEvent(name, elm, detail, cancelable = true) {\r\n    return !elm.dispatchEvent(\r\n        new CustomEvent(`ezg${name}`, { detail, cancelable })\r\n    );\r\n}\r\n"],"names":["activeDraggedElement","startX","startY","lastX","lastY","checkDragPos","defaults","threshold","options","WeakMap","getPointerPosition","e","changedTouches","clientX","clientY","onPointerDown","preventDefault","currentTarget","addOrRemoveEvents","onPointerMove","x","y","opt","get","Math","hypot","dispatchDragEvent","removeDragEvents","getDragPositions","offsetX","offsetY","movementX","movementY","undefined","onPointerUp","remove","fn","document","name","cancelable","elm","detail","dispatchEvent","CustomEvent","dispatchCustomEvent","originalEvent","Object","keys","getPrototypeOf","MouseEvent","addEventListener","set"],"mappings":"kPAEA,IAAIA,EACAC,EAAQC,EACRC,EAAOC,EACPC,EAEJ,MAAMC,EAAW,CACbC,UAAW,GAGTC,EAAU,IAAIC,QAepB,SAASC,EAAmBC,GAExB,OADIA,EAAEC,iBAAgBD,EAAIA,EAAEC,eAAe,IACpC,CAACD,EAAEE,QAASF,EAAEG,SAGzB,SAASC,EAAcJ,GACnBA,EAAEK,iBACFhB,EAAuBW,EAAEM,cACzBZ,GAAe,GAEdJ,EAAQC,GAAUQ,EAAmBC,GAEtCO,IAGJ,SAASC,EAAcR,GAEnB,GADAA,EAAEK,kBACGhB,EAAsB,OAE3B,MAAOoB,EAAGC,GAAKX,EAAmBC,GAElC,GAAIN,EAAc,CACd,MAAMiB,EAAMd,EAAQe,IAAIvB,GAExB,GAAIwB,KAAKC,MAAML,EAAInB,EAAQoB,EAAInB,GAAUoB,EAAIf,UAAW,OAExDF,GAAe,GACdF,EAAOC,GAAS,CAACgB,EAAGC,GAEhBK,EAAkB,YAAaf,IAChCgB,SAEGD,EAAkB,WAAYf,MACpCR,EAAOC,GAAS,CAACgB,EAAGC,IAI7B,SAASO,EAAiBjB,GACtB,MAAOE,EAASC,GAAWJ,EAAmBC,GAC9C,MAAO,CACHV,OAAAA,EACAC,OAAAA,EACAC,MAAAA,EACAC,MAAAA,EAGAS,QAAAA,EACAC,QAAAA,EAGAe,QAAShB,EAAUZ,EACnB6B,QAAShB,EAAUZ,EAGnB6B,UAAWlB,EAAUV,EACrB6B,UAAWlB,EAAUV,GAI7B,SAASuB,IACL3B,OAAuBiC,EAEvBf,GAAkB,GAGtB,SAASgB,EAAYvB,GACbX,IAAyBK,GACzBqB,EAAkB,WAAYf,GAAG,GAGrCgB,IAGJ,SAAST,EAAkBiB,GACvB,MAAMC,EAAKD,EAAS,sBAAwB,mBAC5CE,SAASD,GAAI,UAAWF,GACxBG,SAASD,GAAI,WAAYF,GACzBG,SAASD,GAAI,YAAajB,GAC1BkB,SAASD,GAAI,YAAajB,GAG9B,SAASO,EAAkBY,EAAM3B,EAAG4B,GAAa,GAC7C,OC5GG,SAA6BD,EAAME,EAAKC,EAAQF,GAAa,GAChE,OAAQC,EAAIE,cACR,IAAIC,YAAY,MAAML,IAAQ,CAAEG,OAAAA,EAAQF,WAAAA,KD0GrCK,CACHN,EACAtC,EACA,IACO4B,EAAiBjB,GACpBkC,cAAelC,GAEnB4B,GA/FkBO,OAAOC,KAC7BD,OAAOE,eAAe,IAAIC,WAAW,yBARlC,SAA0BT,EAAKlB,EAAMhB,GACxCkC,EAAIU,iBAAiB,aAAcnC,GAAe,GAClDyB,EAAIU,iBAAiB,YAAanC,GAAe,GACjDP,EAAQ2C,IAAIX,EAAKlB"}